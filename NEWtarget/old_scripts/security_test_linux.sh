#!/bin/sh
trap 'echo "# $BASH_COMMAND"' DEBUG
read MACHINES
read EMAIL
for i in $MACHINES;do ssh -tA -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -q -A ticket_id=9999@sls4root@10.224.64.69 --command sls -c root@$i "'logger -p auth.info "PHC MAINTANANCE - MANUAL HEALTH CHECK"date&&echo&&echo&&hostname&&echo&&echo&&echo ********IFCONFIG*******&&ifconfig -a&&echo &&echo &&echo **************CONTENTS OF APPLICATIONS FOLDER************** &&echo &&echo &&ls -l /applications&&echo &&echo &&echo **********THIS IS THE UPTIME************ &&echo &&echo &&uptime &&echo &&echo &&echo *************** ALL PROCESSES RUNNING NOW******************* &&echo &&echo &&ps -ef &&echo &&echo &&echo &&echo &&echo *****************OPEN PORT CONNECTIONS************* &&echo &echo &&netstat -a &&echo &&echo &&echo *********CRONTAB INFO******** &&echo &&echo &&crontab -l &&echo  &&echo &&echo ****MOUNT INFO******** &&echo &&echo &&mount &&echo &&echo &&echo ***********SHELLS********** &&echo &&cat /etc/shells &&echo &&echo &&echo ****** INSTALLED SERVICES******* &&echo &&cat /var/db/var/installed_x_services &&echo &&echo &&echo *******DISKSPACE DETAILS********* &&echo &&echo && df -h /boot /usr /var /tmp /home / &&echo &&echo &&echo ********OSLEVEL DETAILS*******  &&echo &&echo &&uname -a &&echo &&grep ML /var/db/var/installed_x_services|tail -1  &&echo &&echo &&echo ******ALL FUNCTIONS AND LEVEL********* &&echo&&w&&echo&&echo&&rpm -qa&&echo '""" > security_$i.txt ; mutt -s "info about $i" $EMAIL < /home/seankdavey/Desktop/targets/security_$i.txt;  done
